<!DOCTYPE html>
<html>
  <head>
    <title>Simple Map</title>
    <meta name="viewport" content="initial-scale=1.0">
    <meta charset="utf-8">
    <style>
          #map {
            height: 100%;
          }
          html, body {
            height: 100%;
            margin: 0;
            padding: 0;
          }  
          body {
            overflow-x: hidden;
          } 
          #sidebar-nav {
            height: 100%;
            background-color: black;
          }   
          li {
            margin-bottom: 10px;
          }
          .ui-autocomplete {
            z-index: 10000000;
          }
    </style>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" href="http://code.jquery.com/ui/1.10.3/themes/smoothness/jquery-ui.css"/>
    <script src="http://code.jquery.com/jquery-1.9.1.js"></script>
    <script src="http://code.jquery.com/ui/1.10.3/jquery-ui.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/knockout/2.3.0/knockout-min.js"></script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCXErGvS8GIks7Q7tucPPctR62uj29nnAs&callback=viewModel"
    async defer></script>  
</head>
<body>
    <div class="col-md-3" id="sidebar-nav">
        <h2 style="color:white">Nashville, TN</h2>
        <h4>things to see</h4> <br/>
          
        
    </div>
    
    <div class="col-md-9" id="map"></div>
      
    <div id="myModal" class="modal fade" role="dialog">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title" id="modalheader">Modal Header</h4>
                </div>
                <div class="modal-body" id="article">

                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        var map;
        
        var park = {lat: 36.1490, lng: -86.8120};
        var opry = {lat: 36.2069, lng: -86.6921};
        var vandy = {lat: 36.1447, lng: -86.8027};
        var bird = {lat: 36.1021, lng: -86.8168};
        var belle = {lat: 36.1048, lng: -86.8657};
        
        var locations = ko.observableArray( [
          { id: 'park', name: 'The Parthenon', latlong:  park, wiki: 'Parthenon_(Nashville)'},
          { id: 'opry', name: 'Grand Ole Opry', latlong:  opry, wiki: 'Grand_Ole_Opry'},
          { id: 'vandy', name: 'Vanderbilt University', latlong: vandy, wiki: 'Vanderbilt_University'},
          { id: 'bird', name: 'The Bluebird Cafe', latlong: bird, wiki: 'Bluebird_Caf√©'},
          { id: 'cafe', name: 'Belle Meade Plantation', latlong: belle, wiki: 'Belle_Meade_Plantation'}
        ]);
            
        var viewModel = function() {
            map = new google.maps.Map(document.getElementById('map'), {
              center: {lat: 36.13, lng: -86.767960},
              zoom: 12,
              streetViewControl: false
            });
            
            locations().forEach(function(v,i){
                var marker = new google.maps.Marker({
                    position: v.latlong,
                    map: map,
                    title: v.name
                });
                
                var contentString = '<div id="content">'+
                  '<div id="siteNotice">'+
                  '</div>'+
                  '<h3>' + v.name + '</h3>'+
                  '<div id="bodyContent">'+
                  '<a>WIKI</a>'+
                  '</div>'+
                  '</div>';
                
                var infowindow = new google.maps.InfoWindow({
                    content: contentString
                });
                
                marker.addListener('click', function() {
                    infowindow.open(map, marker);
                    marker.setAnimation(google.maps.Animation.BOUNCE);
                    setTimeout(function(){ marker.setAnimation(null); }, 1400);
                });
                
                infowindow.addListener('click', function() {
                    $.ajax({
                        type: "GET",
                        url: "http://en.wikipedia.org/w/api.php?action=parse&format=json&prop=text&section=0&page=" + v.wiki + "&callback=?",
                        contentType: "application/json; charset=utf-8",
                        async: false,
                        dataType: "json",
                        success: function (data, textStatus, jqXHR) {
                            document.getElementById('modalheader').innerHTML = data.parse.title;
                            var markup = data.parse.text["*"];
                            var blurb = $('<div></div>').html(markup);

                            // remove links as they will not work
                            blurb.find('a').each(function() { $(this).replaceWith($(this).html()); });

                            // remove any references
                            blurb.find('sup').remove();

                            // remove cite error
                            blurb.find('.mw-ext-cite-error').remove();
                            $('#article').html($(blurb).find('p'));
                            $('#myModal').modal('show');

                        },
                        error: function (errorMessage) {
                            $('#article').html(errorMessage);
                            $('#myModal').modal('show');
                        }
                    });
                });
                
            });
          
        };

        ko.applyBindings(new viewModel);


    </script>
      
 
    
      
</body>
</html>